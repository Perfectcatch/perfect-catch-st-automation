# ============================================
# Perfect Catch ST Automation Server
# Environment Configuration
# ============================================

# Server Configuration
PORT=3001
NODE_ENV=development

# ============================================
# ServiceTitan API Credentials (REQUIRED)
# ============================================
SERVICE_TITAN_TENANT_ID=your_tenant_id
SERVICE_TITAN_CLIENT_ID=your_client_id
SERVICE_TITAN_CLIENT_SECRET=your_client_secret
SERVICE_TITAN_APP_KEY=your_app_key

# ============================================
# Database Configuration (CONSOLIDATED)
# ============================================
# Primary database with schema-based organization:
#   - servicetitan: ST jobs, customers, invoices, estimates
#   - pricebook: materials, services, equipment, categories
#   - automation: workflows, messaging templates
#   - integrations: GHL contacts, CallRail calls
#   - public: shared utilities
#
# Connection to main postgres container (port 6432)
DATABASE_URL=postgresql://postgres:password@localhost:6432/perfectcatch_automation
DATABASE_MAX_CONNECTIONS=20

# Schema names (for application code reference)
ST_SCHEMA=servicetitan
PRICEBOOK_SCHEMA=pricebook
AUTOMATION_SCHEMA=automation
INTEGRATIONS_SCHEMA=integrations

# Legacy alias (deprecated - use DATABASE_URL)
# SERVICETITAN_DATABASE_URL=postgresql://postgres:password@localhost:6432/perfectcatch_automation

# ============================================
# OpenAI Configuration (REQUIRED for Chat Agent)
# ============================================
OPENAI_API_KEY=sk-your-openai-api-key

# ============================================
# Redis Configuration (Optional - for session storage)
# ============================================
REDIS_URL=redis://localhost:6379

# ============================================
# Security (Optional)
# ============================================
# Set this to require API key for all requests
# Leave empty to allow unauthenticated access
API_KEY=

# ============================================
# Rate Limiting (Optional)
# ============================================
# Time window in milliseconds (default: 60000 = 1 minute)
RATE_LIMIT_WINDOW_MS=60000
# Max requests per window (default: 100, set to 0 to disable)
RATE_LIMIT_MAX_REQUESTS=100

# ============================================
# Token Management (Optional)
# ============================================
# Seconds before token expiry to refresh (default: 300 = 5 minutes)
TOKEN_REFRESH_BUFFER_SECONDS=300

# ============================================
# Retry Configuration (Optional)
# ============================================
# Maximum retry attempts for 429/5xx errors
MAX_RETRIES=3
# Delay between retries in milliseconds
RETRY_DELAY_MS=1000

# ============================================
# Logging (Optional)
# ============================================
# Log level: fatal, error, warn, info, debug, trace
LOG_LEVEL=info

# ============================================
# Sync Scheduler Configuration (Optional)
# ============================================
# Full sync schedule (cron format) - default: daily at 2 AM
SYNC_FULL_CRON=0 2 * * *
# Incremental sync schedule (cron format) - default: every 6 hours
SYNC_INCREMENTAL_CRON=0 */6 * * *
# Enable/disable scheduler on startup
SYNC_SCHEDULER_ENABLED=true

# ============================================
# ServiceTitan Mirror Database (NEW - Batch 2)
# ============================================
# PostgreSQL connection for ServiceTitan data mirror
# This is separate from the pricebook DATABASE_URL
SERVICETITAN_DATABASE_URL=postgresql://user:password@localhost:5432/servicetitan_mirror

# ============================================
# Twilio SMS Configuration (NEW - Batch 2)
# ============================================
# Get credentials from https://console.twilio.com
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_auth_token_here
TWILIO_PHONE_NUMBER=+15551234567

# ============================================
# SendGrid Email Configuration (NEW - Batch 2)
# ============================================
# Get API key from https://app.sendgrid.com/settings/api_keys
SENDGRID_API_KEY=SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SENDGRID_FROM_EMAIL=noreply@perfectcatch.com
SENDGRID_FROM_NAME=Perfect Catch

# ============================================
# Anthropic API (Optional - for Claude integration)
# ============================================
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxx

# ============================================
# GoHighLevel (GHL) Integration
# ============================================
# API Key from GHL Settings > Business Profile > API Keys
GHL_API_KEY=pit-your-api-key
GHL_LOCATION_ID=your-location-id

# ============================================
# GHL Sync Controls (Batch 10 Emergency Fix)
# ============================================
# IMPORTANT: Keep these FALSE until GHL workflows are disabled
# in the GHL dashboard to prevent duplicate workflow charges!

# Master switch - disable all GHL sync
GHL_SYNC_ENABLED=false

# Individual sync controls (all disabled by default)
GHL_AUTO_SYNC_ESTIMATES=false
GHL_AUTO_SYNC_JOBS=false
GHL_AUTO_SYNC_CUSTOMERS=false

# Deduplication (always enabled - prevents duplicate contacts/opps)
GHL_DEDUP_ENABLED=true

# Sync logging level
GHL_SYNC_LOG_LEVEL=info

# Rate limiting (requests per minute to GHL API)
GHL_RATE_LIMIT=30

# ============================================
# Slack Integration (NEW - Batch 9)
# ============================================
# Create app at https://api.slack.com/apps
# Bot Token Scopes: channels:history, channels:read, chat:write,
#   chat:write.public, commands, im:history, im:read, im:write,
#   users:read, users:read.email

# Bot OAuth Token (starts with xoxb-)
SLACK_BOT_TOKEN=xoxb-your-bot-token

# Signing Secret (for request verification)
SLACK_SIGNING_SECRET=your-signing-secret

# Channel IDs for notifications
SLACK_DISPATCH_CHANNEL=C01234567
SLACK_SALES_CHANNEL=C01234568
SLACK_ACCOUNTING_CHANNEL=C01234569
SLACK_EMERGENCY_CHANNEL=C01234570
SLACK_REPORTS_CHANNEL=C01234571

# On-call user for emergency alerts
SLACK_ONCALL_USER=U01234567

# ============================================
# Salesforce Integration (NEW)
# ============================================
# Create Connected App at: Setup → App Manager → New Connected App
# Enable OAuth with scopes: api, refresh_token, offline_access

# Consumer Key from Connected App
SALESFORCE_CLIENT_ID=your_consumer_key

# Consumer Secret from Connected App
SALESFORCE_CLIENT_SECRET=your_consumer_secret

# OAuth callback URL (must match Connected App settings)
SALESFORCE_REDIRECT_URI=http://localhost:3001/api/salesforce/callback

# Login URL (use https://test.salesforce.com for sandbox)
SALESFORCE_LOGIN_URL=https://login.salesforce.com

# API Version
SALESFORCE_API_VERSION=v59.0

# Salesforce Sync Controls
SALESFORCE_SYNC_ENABLED=false
SALESFORCE_AUTO_SYNC_CUSTOMERS=false
SALESFORCE_SYNC_BATCH_SIZE=200

